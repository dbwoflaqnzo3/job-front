"use client"
import { useState } from 'react';
import Link from 'next/link';
import styles from '../loginPage/page.module.css';

export default function Login() {

    const [formData, setFormData] = useState({
        userId: '',
        password: '',
    });

    const [error, setError] = useState('');

    // 입력값 상태 업데이트 함수
    const handleInputChange = (e) => {
        const { name, value } = e.target;
        setFormData((prevData) => ({
            ...prevData,
            [name]: value,
        }));
    };

    // 폼 제출 시 처리 함수
    const handleSubmit = async (e) => {
        e.preventDefault();

        // 필수 항목이 비어있으면 에러 처리
        if (!formData.userId || !formData.password) {
            setError('모든 필드를 입력해야 합니다.');
            return;
        }

        // 로그인 API 요청 보내는 코드 (예시)
        try {

            // alert(JSON.stringify(formData))
            //fetch 요청
            const response = await fetch('http://localhost:8080/student/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData), // formData는 로그인 폼의 데이터
            });
        
            const result = await response.json();
        
            if (response.ok) {
                // 로그인 성공 시, 토큰을 콘솔에 출력
                document.cookie = `token=${result.token}; path=/;`;
                alert("Login Success")

                // console.log('로그인 성공!');
                // console.log('JWT 토큰:', result.token);  // 서버에서 응답받은 토큰 출력
        
                // 예시: 로그인 성공 후 페이지 리디렉션
                window.location.href = "/mainPage";  // 원하는 페이지로 리디렉션 가능

            } else {
                // 로그인 실패 시 에러 메시지 출력
                setError(result.message || '로그인 실패');
            }
        } catch (err) {
            // 서버와의 연결 문제
            setError('서버와의 연결 문제로 로그인에 실패했습니다.');
        }
    }

    const linkToForgetPw = () => {
        Router
    }

    return (
        <div className={styles.wrapper}>
            <div className={styles.container}>
                {/* 왼쪽 그래픽 */}
                <div className={styles.graphic}>
                    그래픽
                </div>

                {/* 오른쪽 로그인 */}
                <div className={styles.loginWrapper}>
                    <div className={styles.loginContainer}>
                        {/* 로고 부분 */}
                        <div className={styles.logo}>
                            <svg xmlns="http://www.w3.org/2000/svg" width="178" height="40" viewBox="0 0 178 40" fill="none">
                                <path d="M26.5685 38.9521C17.5913 38.9521 8.29805 36.1704 2.48185 31.9979C1.28068 31.1128 1.21746 29.6588 1.84966 28.7105C2.48185 27.699 3.87268 27.1932 5.26351 28.1415C10.5107 31.8715 18.4764 34.4635 26.5685 34.4635C34.3445 34.4635 45.724 31.745 45.724 23.2736V8.03772C45.724 6.89977 44.9654 5.95148 43.701 5.95148H33.333C32.0686 5.95148 31.0571 4.93996 31.0571 3.67557C31.0571 2.4744 32.0686 1.46289 33.333 1.46289H44.27C48.1896 1.46289 50.5919 3.7388 50.5919 7.53197V23.2736C50.5919 34.4003 38.2009 38.9521 26.5685 38.9521Z" fill="#FFA321"/>
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M1.96118 32.7059L1.96123 32.7059C0.350772 31.5192 0.253282 29.5353 1.11216 28.2353C1.54547 27.5482 2.24128 27.0231 3.08066 26.8353C3.93872 26.6434 4.88016 26.8184 5.75838 27.4172L5.76547 27.422L5.77247 27.427C10.858 31.042 18.6422 33.5865 26.5687 33.5865C30.3783 33.5865 35.0322 32.9173 38.6985 31.2474C42.3624 29.5785 44.8462 27.0196 44.8462 23.2747V8.03882C44.8462 7.66252 44.7216 7.3608 44.5396 7.16228C44.3664 6.97328 44.0996 6.83062 43.7012 6.83062H33.3332C31.5839 6.83062 30.1793 5.42599 30.1793 3.67667C30.1793 1.97457 31.6 0.585938 33.3332 0.585938H44.2702C46.3977 0.585938 48.2162 1.20598 49.5079 2.44157C50.8046 3.6819 51.4702 5.44669 51.4702 7.53306V23.2747C51.4702 29.2362 48.1226 33.4131 43.369 36.054C38.6459 38.6779 32.4791 39.8312 26.5687 39.8312C17.443 39.8312 7.96183 37.0108 1.97026 32.7125L1.96118 32.7059ZM1.84989 28.7116C1.21769 29.6599 1.28091 31.1139 2.48208 31.999C8.29828 36.1715 17.5915 38.9532 26.5687 38.9532C38.2011 38.9532 50.5921 34.4014 50.5921 23.2747V7.53306C50.5921 3.73989 48.1898 1.46399 44.2702 1.46399H33.3332C32.0688 1.46399 31.0573 2.4755 31.0573 3.67667C31.0573 4.94106 32.0688 5.95257 33.3332 5.95257H43.7012C44.9656 5.95257 45.7242 6.90087 45.7242 8.03882V23.2747C45.7242 31.7461 34.3447 34.4646 26.5687 34.4646C18.4766 34.4646 10.511 31.8726 5.26374 28.1426C3.87291 27.1943 2.48208 27.7001 1.84989 28.7116Z" fill="#FFA321"/>
                                <path d="M131.218 37.8773C126.097 37.8773 123.885 35.9175 123.885 30.9864V7.9745C123.885 3.67557 126.287 1.46289 130.839 1.46289H158.403C168.581 1.46289 173.891 4.7503 173.891 11.2619C173.891 13.9804 172.564 16.8885 169.34 18.4057C173.259 19.354 176.547 22.515 176.547 27.3197C176.547 34.2738 170.604 37.8773 159.224 37.8773H131.218ZM128.563 30.7967C128.563 32.7566 129.385 33.5152 131.471 33.5152H159.224C168.202 33.5152 171.805 31.4289 171.805 27.3197C171.805 23.2104 168.202 21.1874 159.224 21.1874H128.563V30.7967ZM158.276 16.8252C165.546 16.8252 169.15 14.9286 169.15 11.2619C169.15 7.59518 165.546 5.82504 158.276 5.82504H130.965C129.448 5.82504 128.563 6.64689 128.563 8.10094V16.8252H158.276Z" fill="#FFA321"/>
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M125.033 36.926C123.582 35.5802 123.006 33.5632 123.006 30.9875V7.9756C123.006 5.66478 123.655 3.77089 125.055 2.4655C126.444 1.17018 128.433 0.585938 130.838 0.585938H158.402C163.559 0.585938 167.626 1.41397 170.431 3.17846C173.299 4.98345 174.769 7.72163 174.769 11.263C174.769 13.7416 173.763 16.3844 171.407 18.1791C174.798 19.6611 177.424 22.8342 177.424 27.3208C177.424 31.1008 175.781 34.0261 172.609 35.9574C169.5 37.8497 164.98 38.7565 159.224 38.7565H131.217C128.577 38.7565 126.469 38.2572 125.033 36.926ZM170.528 18.77C173.901 20.0243 176.546 23.0114 176.546 27.3208C176.546 34.2749 170.603 37.8784 159.224 37.8784H131.217C126.097 37.8784 123.884 35.9186 123.884 30.9875V7.9756C123.884 3.67667 126.286 1.46399 130.838 1.46399H158.402C168.58 1.46399 173.891 4.7514 173.891 11.263C173.891 13.6548 172.863 16.1935 170.42 17.8024C170.086 18.0221 169.726 18.2245 169.339 18.4068C169.743 18.5046 170.14 18.6259 170.528 18.77ZM129.833 32.2497C130.051 32.4536 130.497 32.6382 131.47 32.6382H159.224C163.678 32.6382 166.649 32.1148 168.48 31.1778C169.379 30.7181 169.976 30.1721 170.354 29.5607C170.731 28.9503 170.926 28.2162 170.926 27.3208C170.926 26.4253 170.731 25.6964 170.356 25.0932C169.979 24.489 169.384 23.9505 168.485 23.4978C166.653 22.5747 163.681 22.0665 159.224 22.0665H129.44V30.7978C129.44 31.6825 129.63 32.0607 129.833 32.2497ZM128.562 30.7978C128.562 32.7576 129.384 33.5163 131.47 33.5163H159.224C168.201 33.5163 171.804 31.43 171.804 27.3208C171.804 23.2115 168.201 21.1885 159.224 21.1885H128.562V30.7978ZM167.737 13.2001C168.085 12.6648 168.271 12.0292 168.271 11.263C168.271 10.497 168.085 9.87209 167.74 9.35144C167.392 8.82577 166.847 8.35355 166.047 7.95558C164.422 7.14647 161.869 6.70418 158.275 6.70418H130.964C130.358 6.70418 129.999 6.86693 129.797 7.05785C129.601 7.24162 129.44 7.55613 129.44 8.10203V15.9483H158.275C161.862 15.9483 164.413 15.4758 166.036 14.6392C166.836 14.2272 167.385 13.7401 167.737 13.2001ZM158.275 16.8263C165.546 16.8263 169.149 14.9297 169.149 11.263C169.149 7.59628 165.546 5.82613 158.275 5.82613H130.964C129.447 5.82613 128.562 6.64799 128.562 8.10203V16.8263H158.275Z" fill="#FFA321"/>
                                <path d="M114.554 10.9061C115.13 10.7169 115.344 10.0163 114.942 9.56307C109.913 3.89652 100.479 0.167939 88.8192 0.167939C71.244 0.167939 58.7267 8.63931 58.7267 19.4499C58.7267 30.2604 71.244 38.7318 88.8192 38.7318C100.658 38.7318 110.202 34.8876 115.171 29.0738C115.56 28.6183 115.342 27.9298 114.773 27.7427L91.5951 20.1226C90.79 19.8579 90.79 18.719 91.5951 18.4543L114.554 10.9061Z" fill="#FFA321"/>
                                <circle cx="107.898" cy="19.4857" r="2.63415" fill="#0084D0"/>
                            </svg>
                        </div>

                        {/* 메인 로그인 부분 */}
                        <div className={styles.formWrapper}>
                            <form onSubmit={handleSubmit} className={styles.loginForm}>
                                <div className={styles.userId}>
                                    <input
                                        className={styles.userIdInput}
                                        type="text"
                                        id="userId"
                                        name="userId"
                                        placeholder="아이디/ID"
                                        value={formData.userId}
                                        onChange={handleInputChange}
                                    />
                                </div>
                                <div className={styles.userPw}>
                                    <input
                                        className={styles.userPwInput}
                                        type="password"
                                        id="password"
                                        name="password"
                                        placeholder="비밀번호/password"
                                        value={formData.password}
                                        onChange={handleInputChange}
                                    />
                                </div>
                                {error && <p style={{ color: 'red' }} className={styles.error}>{error}</p>}
                                <button type="submit" className={styles.loginButton}>
                                    로그인
                                </button>
                            </form>
                        </div>
                        {/* 비번 찾기 부분 */}
                        <Link  href="../loginPage/forgetPw" className={styles.forgetPw}>
                            비밀번호를 잊으셨나요?
                        </Link>
                    </div>
                </div>
            </div>
        </div>
    );
}


